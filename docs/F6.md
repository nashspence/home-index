# F6 Remote file operations via API

## 1 Why a file operations API?

Users may work on laptops or other devices where it is inconvenient to mount the
full project directory. F6 exposes a lightweight HTTP service so remote scripts
can upload, move or remove files. After a short delay Home‑Index updates the
metadata store and search index without waiting for the next scheduled scan.

---

## 2 How it works

Uploads use WebDAV so standard tools work:

```bash
curl -T ./docs/note.txt http://localhost:8000/dav/docs/note.txt
```

Moves and deletes use a JSON API:

```json
{
  "move": [{"src": "docs/note.txt", "dest": "archive/note.txt"}],
  "delete": ["old.txt"]
}
```

Paths are relative to `INDEX_DIRECTORY` (default `/files`). After the last
mutating call, Home‑Index writes metadata and updates Meilisearch within a few
seconds—no full rescan needed.

---

## 3 Minimal `docker-compose.yml`

```yaml
services:
  home-index:
    image: ghcr.io/nashspence/home-index:latest
    environment:
      - CRON_EXPRESSION=* * * * *
    volumes:
      - ./input:/files:rw
      - ./output:/home-index
    ports:
      - "8000:8000"
    depends_on: [meilisearch]
  meilisearch:
    image: getmeili/meilisearch:v1.15
    environment: [MEILI_NO_ANALYTICS=true]
    volumes: [./output/meili:/meili_data]
```

---

## 4 Acceptance criteria

| # | Scenario & pre‑conditions | Steps (user actions → expected behaviour) |
|---|---------------------------|-------------------------------------------|
| **1** | **Add a file**<br>Stack running and endpoint reachable. | 1 `curl -T ./a.txt http://localhost:8000/dav/a.txt` → `output/metadata/by-id/<hash>/document.json` exists and searching for that `id` returns a document without waiting for a cron tick. |
| **2** | **Move a file** | 1 After Scenario 1 POST `{"move":[{"src":"a.txt","dest":"b.txt"}]}` to `/fileops` → Document’s `paths` contain `b.txt` and no longer include `a.txt`; search results show the new path within seconds. |
| **3** | **Delete a file** | 1 POST `{"delete":["b.txt"]}` to `/fileops` → Document disappears from both metadata store and search index. |
| **4** | **Batch operations** | 1 Upload two files via `/dav` then POST a single body `{"move":[{"src":"c.txt","dest":"e.txt"}], "delete": ["d.txt"]}` → All changes reflected correctly after the response. |

Scenarios must pass unchanged on Linux, macOS and Windows (WSL).

---

**End of specification**
