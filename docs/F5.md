# F5. "I want to search file chunks by concept"

## Value

Concept search surfaces relevant passages even when you don't know the exact words.

---

## Usage

Modules can emit chunk documents with text segments. Meilisearch can embed these
chunks automatically using a Hugging Face model. Enable the vector store and
register an embedder:

```bash
curl -X PATCH 'http://localhost:7700/experimental-features' \
  -H 'Content-Type: application/json' \
  --data '{"vectorStore": true}'

curl -X PATCH 'http://localhost:7700/indexes/file_chunks/settings/embedders' \
  -H 'Content-Type: application/json' \
  --data '{
    "e5-small": {
      "source": "huggingFace",
      "model": "intfloat/e5-small-v2",
      "dimensions": 384,
      "documentTemplate": "passage: {{doc.text}}"
    }
  }'
```

Index your documents normally. Meilisearch expands the template and stores the
resulting vectors under `_vectors.e5-small`.

Search with a query prefixed by `query:` and reference the embedder by name:

```bash
curl -X POST 'http://localhost:7700/indexes/file_chunks/search' \
  -H 'Content-Type: application/json' \
  --data '{
    "q": "query: positive psychology",
    "hybrid": {"semanticRatio": 1, "embedder": "e5-small"}
  }'
```

The response contains matching chunks along with their parent file IDs.

---

## Minimal `docker-compose.yml`

```yaml
services:
  home-index:
    image: ghcr.io/nashspence/home-index:latest
    environment:
      - METADATA_DIRECTORY=/home-index/metadata
      - MODULES=http://chunk-module:9000
    volumes:
      - ./input:/files:ro
      - ./output:/home-index
    depends_on:
      - meilisearch
      - chunk-module
  meilisearch:
    image: getmeili/meilisearch:latest
    environment:
      - MEILI_NO_ANALYTICS=true
    volumes:
      - ./output/meili:/meili_data
    ports:
      - "7700:7700"
  chunk-module:
    build: ./chunk_module
    environment:
      - METADATA_DIRECTORY=/home-index/metadata
    volumes:
      - ./input:/files:ro
      - ./output:/home-index
```

---

## Input â†” Output

| **Your single action** | **What you will literally see** |
| --- | --- |
| Run `docker compose up -d` with a module that emits chunk documents | A subfolder for the module appears under `./output/metadata/by-id/<file-hash>/` containing chunk JSON files. Vector searches on the `file_chunks` index return those chunks. |

---

## Acceptance

1. After indexing completes, a chunk JSON file exists under `./output/metadata/by-id/<file-hash>/chunk_module/`.
2. Searching the `file_chunks` index with the query vector returns the chunk document when filtered by `file_id`.
3. The chunk document includes `id`, `file_id`, `module`, `text`, and `_vector` fields.
