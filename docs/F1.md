# F1. “I want scheduled file-sync”

## Value

A scheduled sync keeps the server responsive while new files are indexed at predictable times. Fresh metadata appears automatically—no manual trigger required.

---

## Usage

Set `CRON_EXPRESSION` when you launch Home-Index.
Both five-field (`m h dom mon dow`) and six-field (`s m h dom mon dow`) cron formats work; include seconds for sub-minute schedules, e.g.

```yaml
environment:
  - CRON_EXPRESSION=*/10 * * * * *   # every ten seconds
```

---

## Acceptance

| Scenario                       | Home-Index **input**                                                                | Home-Index **output**                                                                                                                                                                                                                           |
| ------------------------------ | ----------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **1 – First launch**           | Start the stack with a valid `CRON_EXPRESSION` and at least one file in `./input/`. | • A file `output/files.log` appears.<br>• At the first cron tick, the log shows a line that starts `… start file sync`.<br>• For every file in `./input/`, a folder `output/metadata/by-id/<file-hash>/` is created containing `document.json`. |
| **2 – Regular cadence**        | Allow the stack to run.                                                             | Additional `start file sync` lines are appended to `files.log` at the interval implied by your cron expression—never faster.                                                                                                                    |
| **3 – Change the schedule**    | Edit `CRON_EXPRESSION` and restart the stack.                                       | The timing between subsequent `start file sync` lines follows the **new** schedule.                                                                                                                                                             |
| **4 – Fresh state on restart** | Stop the containers and start them again with the same schedule.                    | `output/` is recreated from scratch; a new `files.log` begins, and the first sync occurs at the first tick after startup.                                                                                                                       |

---

## Minimal `docker-compose.yml`

```yaml
services:
  home-index:
    image: ghcr.io/nashspence/home-index:latest
    environment:
      - CRON_EXPRESSION=* * * * *        # every minute; edit to taste
      - METADATA_DIRECTORY=/home-index/metadata
    volumes:
      - ./input:/files:ro                # source files (read-only)
      - ./output:/home-index             # logs & metadata
    depends_on:
      - meilisearch

  meilisearch:
    image: getmeili/meilisearch:latest
    volumes:
      - ./output/meili:/meili_data       # search index persists
```
