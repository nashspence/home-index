services:
  home-index:
    image: ${IMAGE}
    environment:
      - METADATA_DIRECTORY=/home-index/metadata
      - MODULES=http://example-module:9000
    volumes:
      - ./input:/files:ro
      - ./output:/home-index
    depends_on:
      - meilisearch
      - example-module
  meilisearch:
    image: getmeili/meilisearch:v1.15.2
    environment:
      - MEILI_NO_ANALYTICS=true
      - MEILI_LOG_LEVEL=warn
    volumes:
      - ./output/meili:/meili_data
    ports:
      - "7700:7700"
  example-module:
    build:
      # Build the example module from the repository root so the Dockerfile
      # can install the version under test via a local COPY.
      context: ../../..
      dockerfile: examples/module_template/Dockerfile
    volumes:
      - ./input:/files:ro
      - ./output:/home-index
