# f2 file search

## f2s1 initial sync
### if
* [*files*](glossary.md#files) with duplicates
### when
* service starts
### then
* exactly one [*doc*](glossary.md#doc) per unique bytes
* duplicate [*paths*](glossary.md#paths) resolve to same [*doc*](glossary.md#doc)

## f2s2 fields
### if
* any [*doc*](glossary.md#doc)
### when
* [*doc*](glossary.md#doc) opened
### then
* fields `id` `paths` `paths_list` `size` `mtime` `type` `copies` exist

## f2s3 filter single
### if
* [*search host*](glossary.md#search-host) healthy
### when
* search with one [*filter*](glossary.md#filter)
### then
* results match [*filter*](glossary.md#filter)

## f2s4 filter multi
### if
* [*search host*](glossary.md#search-host) healthy
### when
* search with multiple [*filter*](glossary.md#filter) clauses
### then
* results satisfy all clauses

## f2s5 add duplicate
### if
* [*files*](glossary.md#files) contain unique file
### when
* duplicate copy added
### then
* original [*doc*](glossary.md#doc) `copies` increments
* no new [*hashes*](glossary.md#hashes) dir

## f2s6 delete partial
### if
* file has multiple [*paths*](glossary.md#paths)
### when
* one path removed
### then
* [*doc*](glossary.md#doc) remains with decremented `copies`

## f2s7 delete last
### if
* single remaining [*path*](glossary.md#paths)
### when
* last path removed
### then
* [*doc*](glossary.md#doc) and [*hashes*](glossary.md#hashes) removed

## f2s8 modify bytes
### if
* existing file bytes change
### when
* next sync
### then
* new [*doc*](glossary.md#doc) created
* old [*doc*](glossary.md#doc) retained

## f2s9 symlink
### if
* [*paths*](glossary.md#paths) symlink exists
### when
* symlink resolved
### then
* target stays in [*hashes*](glossary.md#hashes)

## f2s10 search update
### if
* [*doc*](glossary.md#doc) changed
### when
* search with [*filter*](glossary.md#filter)
### then
* [*search host*](glossary.md#search-host) returns latest values
