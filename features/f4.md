# f4 derivers

## f4s1 initial enrichment
### if
* [*queue host*](glossary.md#queue-host) set
* [*deriver host*](glossary.md#deriver-host) available
### when
* service starts
### then
* archive jobs run first then regular
* markers flip pending to ready

## f4s2 plug-in archive drive
### if
* drive with pending jobs remounted
### when
* sync runs
### then
* its jobs run before others and marker becomes ready

## f4s3 remove drive mid-run
### if
* drive processing
### when
* drive unplugged
### then
* remaining jobs pause until drive returns; marker stays pending

## f4s4 uid or order change
### if
* module list or uid changes
### when
* stack restarts
### then
* files requeued from change point; markers pend then ready

## f4s5 status files ignored
### if
* `*-status-ready` file exists in archive root
### when
* derivers run
### then
* file ignored and never processed

## f4s6 non-archive unaffected
### if
* regular file added while archive jobs running
### when
* derivers process
### then
* archive jobs finish before regular file

## f4s7 legacy docs searchable
### if
* metadata from old module version
### when
* search runs before requeue
### then
* search works and no crashes

## f4s8 run-timeout
### if
* module run exceeds `timeout`
### when
* job executes
### then
* job requeued until success

## f4s9 check-timeout
### if
* module check hangs
### when
* job executes
### then
* job requeued until success

## f4s10 restart no change
### if
* stack restarts with same module list
### when
* service starts
### then
* no jobs requeued; markers unchanged

## f4s11 queue item uid mismatch
### if
* stale queue items with old uid exist
### when
* deriver runs
### then
* mismatched items skipped and retried later

## f4s12 wrong MODULE_UID env
### if
* container `MODULE_UID` not in config
### when
* module starts
### then
* module logs misconfiguration and exits

## f4s13 parallel modules crash isolation
### if
* multiple modules run
### when
* one crashes
### then
* others finish and tokens released

## f4s14 share-group rotation
### if
* two modules share token name
### when
* jobs run
### then
* turns alternate and modules needing multiple tokens run only with all

## f4s15 meilisearch update
### if
* module returns new data
### when
* run completes
### then
* [*doc*](glossary.md#doc) updated and [*search host*](glossary.md#search-host) reflects change
