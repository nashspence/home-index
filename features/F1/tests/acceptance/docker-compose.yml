services:
  home-index:
    image: ${IMAGE}
    extra_hosts:
      - "host.docker.internal:host-gateway"
    environment:
      - CRON_EXPRESSION=${CRON_EXPRESSION}
      - METADATA_DIRECTORY=/home-index/metadata
      - TEST=true
      - TEST_LOG_TARGET=${TEST_LOG_TARGET:-http://host.docker.internal:9020}
      - DEBUG=${DEBUG:-False}
      - DEBUGPY_HOST=${DEBUGPY_HOST:-0.0.0.0}
      - DEBUGPY_PORT=${DEBUGPY_PORT:-5678}
      - WAIT_FOR_DEBUGPY_CLIENT=${WAIT_FOR_DEBUGPY_CLIENT:-False}
    volumes:
      - ./input:/files:ro
      - ./output:/home-index
    ports:
      - "5678:5678"
    depends_on:
      - meilisearch
  meilisearch:
    image: getmeili/meilisearch:v1.15
    environment:
      - MEILI_NO_ANALYTICS=true
      - MEILI_LOG_LEVEL=warn
    volumes:
      - ./output/meili:/meili_data
    ports:
      - "7700:7700"

